<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.keboda.eomsback.flux.mapper.InvLotMapper">
    <insert id="insertSelective">
        insert into INV_LOT
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="organizationid != null">
                organizationid,
            </if>
            <if test="warehouseid != null">
                warehouseid,
            </if>
            <if test="lotnum != null">
                lotnum,
            </if>
            <if test="customerid != null">
                customerid,
            </if>
            <if test="sku != null">
                sku,
            </if>
            <if test="qty != null">
                qty,
            </if>
            <if test="qtyallocated != null">
                qtyallocated,
            </if>

            <if test="qtypreallocated != null">
                qtypreallocated,
            </if>
            <if test="qtyonhold != null">
                qtyonhold,
            </if>

            <if test="grossweight != null">
                grossweight,
            </if>
            <if test="netweight != null">
                netweight,
            </if>
            <if test="cubic != null">
                cubic,
            </if>
            <if test="price != null">
                price,
            </if>

            <if test="notetext != null">
                notetext,
            </if>
            <if test="udf01 != null">
                udf01,
            </if>
            <if test="udf02 != null">
                udf02,
            </if>
            <if test="udf03 != null">
                udf03,
            </if>
            <if test="udf04 != null">
                udf04,
            </if>
            <if test="udf05 != null">
                udf05,
            </if>
            <if test="udf06 != null">
                udf06,
            </if>

            <if test="currentversion != null">
                currentversion,
            </if>
            <if test="oprseqflag != null">
                oprseqflag,
            </if>
            <if test="addwho != null">
                addwho,
            </if>
            <if test="addtime != null">
                addtime,
            </if>
            <if test="editwho != null">
                editwho,
            </if>
            <if test="edittime != null">
                edittime,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="organizationid != null">
                #{organizationid},
            </if>
            <if test="warehouseid != null">
                #{warehouseid},
            </if>
            <if test="lotnum != null">
                #{lotnum},
            </if>
            <if test="customerid != null">
                #{customerid},
            </if>
            <if test="sku != null">
                #{sku},
            </if>
            <if test="qty != null">
                #{qty},
            </if>
            <if test="qtyallocated != null">
                #{qtyallocated},
            </if>

            <if test="qtypreallocated != null">
                #{qtypreallocated},
            </if>
            <if test="qtyonhold != null">
                #{qtyonhold},
            </if>
            <if test="grossweight != null">
                #{grossweight},
            </if>
            <if test="netweight != null">
                #{netweight},
            </if>
            <if test="cubic != null">
                #{cubic},
            </if>
            <if test="price != null">
                #{price},
            </if>
            <if test="notetext != null">
                #{notetext},
            </if>
            <if test="udf01 != null">
                #{udf01},
            </if>
            <if test="udf02 != null">
                #{udf02},
            </if>
            <if test="udf03 != null">
                #{udf03},
            </if>
            <if test="udf04 != null">
                #{udf04},
            </if>
            <if test="udf05 != null">
                #{udf05},
            </if>
            <if test="udf06 != null">
                #{udf06},
            </if>
            <if test="currentversion != null">
                #{currentversion},
            </if>
            <if test="oprseqflag != null">
                #{oprseqflag},
            </if>
            <if test="addwho != null">
                #{addwho},
            </if>
            <if test="addtime != null">
                #{addtime},
            </if>
            <if test="editwho != null">
                #{editwho},
            </if>
            <if test="edittime != null">
                #{edittime},
            </if>
        </trim>
    </insert>

    <update id="updateQty">
        update INV_LOT
        set organizationId = t.organizationid, warehouseId = t.warehouseId, customerId = t.customerId , sku = t.sku,
            qty = t.qty ,qtyAllocated = t.qtyAllocated, qtyPreAllocated = t.qtyAllocated,grossWeight = t.grossWeight,
            currentVersion = a.currentVersion + 1,editWho = #{editwho},editTime = #{edittime}
        from INV_LOT a
        left join (
            select organizationid,warehouseId,lotNum,customerId,sku,sum(qty) as qty ,sum(qtyAllocated) as qtyAllocated,sum(qtyOnHold)as qtyOnHold,sum(grossWeight) as grossWeight
            from inv_lot_loc_id
            group by organizationid,warehouseId,lotNum,customerId,sku
        ) t on a.lotnum = t.lotnum
        where a.lotNum = #{lotnum}
    </update>
    <select id="selectByKey" resultType="com.keboda.eomsback.flux.pojo.InvLot">
        select *
        from INV_LOT
        where lotnum = #{lotnum}
    </select>
</mapper>