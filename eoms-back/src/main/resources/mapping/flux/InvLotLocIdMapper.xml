<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.keboda.eomsback.flux.mapper.InvLotLocIdMapper">
    <insert id="insertSelective">
        insert into INV_LOT_LOC_ID
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="organizationid != null">
                organizationid,
            </if>
            <if test="warehouseid != null">
                warehouseid,
            </if>
            <if test="locationid != null">
                locationid,
            </if>
            <if test="lotnum != null">
                lotnum,
            </if>
            <if test="traceid != null">
                traceid,
            </if>
            <if test="customerid != null">
                customerid,
            </if>
            <if test="sku != null">
                sku,
            </if>
            <if test="qty != null">
                qty,
            </if>
            <if test="qtyallocated != null">
                qtyallocated,
            </if>
            <if test="qtyrpin != null">
                qtyrpin,
            </if>
            <if test="qtyrpout != null">
                qtyrpout,
            </if>
            <if test="qtymvin != null">
                qtymvin,
            </if>
            <if test="qtymvout != null">
                qtymvout,
            </if>
            <if test="qtyonhold != null">
                qtyonhold,
            </if>
            <if test="onholdlocker != null">
                onholdlocker,
            </if>
            <if test="grossweight != null">
                grossweight,
            </if>
            <if test="netweight != null">
                netweight,
            </if>
            <if test="cubic != null">
                cubic,
            </if>
            <if test="price != null">
                price,
            </if>
            <if test="qtypa != null">
                qtypa,
            </if>
            <if test="qcstatus != null">
                qcstatus,
            </if>
            <if test="lastmaintenancedate != null">
                lastmaintenancedate,
            </if>
            <if test="notetext != null">
                notetext,
            </if>
            <if test="udf01 != null">
                udf01,
            </if>
            <if test="udf02 != null">
                udf02,
            </if>
            <if test="udf03 != null">
                udf03,
            </if>
            <if test="udf04 != null">
                udf04,
            </if>
            <if test="udf05 != null">
                udf05,
            </if>
            <if test="udf06 != null">
                udf06,
            </if>
            <if test="currentversion != null">
                currentversion,
            </if>
            <if test="oprseqflag != null">
                oprseqflag,
            </if>
            <if test="addwho != null">
                addwho,
            </if>
            <if test="addtime != null">
                addtime,
            </if>
            <if test="editwho != null">
                editwho,
            </if>
            <if test="edittime != null">
                edittime,
            </if>
            <if test="inloctime != null">
                inloctime,
            </if>
            <if test="muid != null">
                muid,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="organizationid != null">
                #{organizationid},
            </if>
            <if test="warehouseid != null">
                #{warehouseid},
            </if>
            <if test="locationid != null">
                #{locationid},
            </if>
            <if test="lotnum != null">
                #{lotnum},
            </if>
            <if test="traceid != null">
                #{traceid},
            </if>
            <if test="customerid != null">
                #{customerid},
            </if>
            <if test="sku != null">
                #{sku},
            </if>
            <if test="qty != null">
                #{qty},
            </if>
            <if test="qtyallocated != null">
                #{qtyallocated},
            </if>
            <if test="qtyrpin != null">
                #{qtyrpin},
            </if>
            <if test="qtyrpout != null">
                #{qtyrpout},
            </if>
            <if test="qtymvin != null">
                #{qtymvin},
            </if>
            <if test="qtymvout != null">
                #{qtymvout},
            </if>
            <if test="qtyonhold != null">
                #{qtyonhold},
            </if>
            <if test="onholdlocker != null">
                #{onholdlocker},
            </if>
            <if test="grossweight != null">
                #{grossweight},
            </if>
            <if test="netweight != null">
                #{netweight},
            </if>
            <if test="cubic != null">
                #{cubic},
            </if>
            <if test="price != null">
                #{price},
            </if>
            <if test="qtypa != null">
                #{qtypa},
            </if>
            <if test="qcstatus != null">
                #{qcstatus},
            </if>
            <if test="lastmaintenancedate != null">
                #{lastmaintenancedate},
            </if>
            <if test="notetext != null">
                #{notetext},
            </if>
            <if test="udf01 != null">
                #{udf01},
            </if>
            <if test="udf02 != null">
                #{udf02},
            </if>
            <if test="udf03 != null">
                #{udf03},
            </if>
            <if test="udf04 != null">
                #{udf04},
            </if>
            <if test="udf05 != null">
                #{udf05},
            </if>
            <if test="udf06 != null">
                #{udf06},
            </if>
            <if test="currentversion != null">
                #{currentversion},
            </if>
            <if test="oprseqflag != null">
                #{oprseqflag},
            </if>
            <if test="addwho != null">
                #{addwho},
            </if>
            <if test="addtime != null">
                #{addtime},
            </if>
            <if test="editwho != null">
                #{editwho},
            </if>
            <if test="edittime != null">
                #{edittime},
            </if>
            <if test="inloctime != null">
                #{inloctime},
            </if>
            <if test="muid != null">
                #{muid},
            </if>
        </trim>

    </insert>
    <update id="updateQty">
        update INV_LOT_LOC_ID
        set qty =  #{qty}, currentVersion = currentVersion + 1, grossWeight = #{grossweight},editwho = #{editwho},edittime = #{edittime}
        where locationId = #{locationid} and lotnum = #{lotnum} and traceId = #{traceid}

    </update>

    <select id="invLotLocIdListPageHelper" resultType="com.keboda.eomsback.flux.pojo.InvLotLocId">
        select a.customerId, a.locationId, a.lotnum, a.traceId,b.sku,b.skuDescr1 ,
        b.skuDescr2 ,e.freightDescr1 as freightclass,
        a.qty,a.grossweight,
        a.qty - a.qtyAllocated - a.qtyRpOut - a.qtyMvOut - a.qtyOnHold  asqtyavailed,
        d.lotAtt04,d.lotAtt05,d.lotAtt06,d.lotAtt07,d.lotAtt08, a.qty - a.qtyAllocated - a.qtyRpOut - a.qtyMvOut - a.qtyOnHold as iqty
        from  INV_LOT_LOC_ID a
        LEFT  JOIN BAS_SKU b on a.customerId = b.customerId AND a.sku = b.sku
        LEFT  JOIN BAS_CUSTOMERFREIGHT e  ON b.customerId = e.customerId AND e.freightCode = b.freightClass
        LEFT JOIN INV_LOT_ATT d  ON d.lotNum = a.lotNum
        <where>
            <if test="centre != null and centre != '' ">
                and a.customerid = #{centre}
            </if>
            <if test="ima != null and ima != '' ">
                and  b.sku like '%${ima}%'
            </if>
            <if test="code_2 != null and code_2 != '' ">
                and d.lotAtt08 = #{code_2}
            </if>
            <if test="code_3 != null and code_3 != '' ">
                and a.lotnum like '%${code_3}%'
            </if>
            <if test="code_4 != null and code_4 != '' ">
                and a.traceId like '%${code_4}%'
            </if>
        </where>
        order by a.customerid,a.locationId,a.sku
    </select>
    <select id="selectByKey" resultType="com.keboda.eomsback.flux.pojo.InvLotLocId">
        select *,qty - qtyAllocated - qtyRpOut - qtyMvOut - qtyOnHold  asqtyavailed
        from INV_LOT_LOC_ID
        where locationid = #{locationid} and lotnum = #{lotnum} and traceid = #{traceid}
    </select>
</mapper>